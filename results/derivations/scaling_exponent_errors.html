<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scaling Exponent Errors in Approach 2</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            font-family: 'Georgia', serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 0 20px;
            line-height: 1.6;
            color: #333;
        }
        h1, h2, h3 { color: #1a1a1a; }
        h1 { border-bottom: 2px solid #333; padding-bottom: 10px; }
        h2 { margin-top: 2em; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
        .derivation { 
            background: #f9f9f9; 
            padding: 15px 20px; 
            margin: 15px 0; 
            border-left: 3px solid #666;
        }
        .result {
            background: #e8f4e8;
            padding: 15px 20px;
            margin: 15px 0;
            border-left: 3px solid #2a6;
        }
        .note {
            background: #fff8e8;
            padding: 10px 15px;
            margin: 10px 0;
            border-left: 3px solid #c90;
            font-size: 0.95em;
        }
    </style>
</head>
<body>

<h1>Derivation: Scaling Exponent and Intercept Errors in Chinchilla Approach 2</h1>

<p>We derive a closed-form expression for the vertex shift δw as a function of the loss surface parameters (α, β) and grid specification (W, n).</p>

<h2>1. Setup</h2>

<p>The loss along an IsoFLOP contour is:</p>
\[ L(N; C) = E + A N^{-\alpha} + B \cdot 6^\beta C^{-\beta} N^\beta \]

<p>Let \(w = \log_{10}(N/N^*)\), where \(N^*\) is the true optimum. Then:</p>

<div class="derivation">
\[ L(w) = E + P \cdot 10^{-\alpha w} + R \cdot 10^{\beta w} \]
where \(P = A \cdot (N^*)^{-\alpha}\) and \(R = B \cdot 6^\beta C^{-\beta} (N^*)^\beta\).
</div>

<p>At the true optimum, the first-order condition gives:</p>
\[ \alpha P = \beta R \]

<h2>2. Parabola Fit via Least Squares</h2>

<p>We sample at \(n\) equally-spaced points \(w_i \in [-W, W]\) and fit a parabola:</p>
\[ \hat{L}(w) = a_0 + a_1 w + a_2 w^2 \]

<p>For symmetric grid points, the least-squares coefficients are:</p>

<div class="derivation">
\[ a_1 = \frac{\sum_i w_i \cdot L(w_i)}{\sum_i w_i^2} \]

\[ a_2 = \frac{n \sum_i w_i^2 L(w_i) - (\sum_i w_i^2)(\sum_i L(w_i))}{n \sum_i w_i^4 - (\sum_i w_i^2)^2} \]
</div>

<h2>3. Key Simplification: Normalize by R</h2>

<p>Since \(\alpha P = \beta R\), we have \(P = (\beta/\alpha) R\). The loss becomes:</p>
\[ L(w) = E + R \left[ \frac{\beta}{\alpha} \cdot 10^{-\alpha w} + 10^{\beta w} \right] \]

<p>Define the <strong>normalized loss contribution</strong>:</p>
\[ \tilde{L}(w) = \frac{\beta}{\alpha} \cdot 10^{-\alpha w} + 10^{\beta w} \]

<p>The actual loss is \(L(w) = E + R \cdot \tilde{L}(w)\).</p>

<div class="note">
<strong>Critical observation:</strong> The constant \(E\) doesn't affect the parabola vertex (it shifts the parabola vertically but not horizontally). The scale factor \(R\) cancels in the ratio \(a_1/a_2\). Therefore:
\[ \delta w = -\frac{a_1}{2a_2} = f(\alpha, \beta, W, n) \]
<strong>The vertex shift depends only on α, β, W, and n — not on C, E, A, B, or R.</strong>
</div>

<h2>4. Closed-Form Expression for δw</h2>

<p>Substituting \(\tilde{L}(w_i)\) into the least-squares formulas:</p>

<div class="result">
<strong>Vertex shift formula:</strong>
\[ \delta w = -\frac{a_1}{2a_2} = -\frac{\sum_i w_i \cdot \tilde{L}(w_i)}{2 \sum_i w_i^2} \cdot \frac{n \sum_i w_i^4 - (\sum_i w_i^2)^2}{n \sum_i w_i^2 \tilde{L}(w_i) - (\sum_i w_i^2)(\sum_i \tilde{L}(w_i))} \]

where:
\[ \tilde{L}(w) = \frac{\beta}{\alpha} \cdot 10^{-\alpha w} + 10^{\beta w} \]

and the sums are over equally-spaced points \(w_i \in [-W, W]\).
</div>

<h3>Special Case: α = β</h3>

<p>When \(\alpha = \beta\), the normalized loss simplifies to:</p>
\[ \tilde{L}(w) = 10^{-\alpha w} + 10^{\alpha w} = 2 \cosh(\alpha w \ln 10) \]

<p>This is symmetric about \(w = 0\), so \(\sum_i w_i \tilde{L}(w_i) = 0\) (odd function times even function summed over symmetric points).</p>

<p>Therefore \(a_1 = 0\) and \(\delta w = 0\).</p>

<h2>5. Intercept Error</h2>

<p>The inferred optimum is:</p>
\[ \hat{N}^* = N^* \cdot 10^{\delta w} \]

<p>Since the true scaling is \(N^* = a_0 \cdot C^a\), the inferred scaling is:</p>
\[ \hat{N}^* = a_0 \cdot 10^{\delta w} \cdot C^a = \hat{a}_0 \cdot C^a \]

<div class="result">
<strong>Intercept error:</strong>
\[ \frac{\hat{a}_0 - a_0}{a_0} = 10^{\delta w} - 1 \]

where \(\delta w = f(\alpha, \beta, W, n)\) is the vertex shift formula above.
</div>

<h2>6. Exponent Preservation</h2>

<p>Since \(\delta w\) is independent of \(C\):</p>
\[ \log_{10}(\hat{N}^*) = \log_{10}(a_0) + \delta w + a \cdot \log_{10}(C) \]

<p>Fitting \(\log_{10}(\hat{N}^*)\) vs \(\log_{10}(C)\) across multiple compute budgets:</p>
<ul>
    <li><strong>Slope</strong> = \(a\) (exact, because \(\delta w\) is constant)</li>
    <li><strong>Intercept</strong> = \(\log_{10}(a_0) + \delta w\) (shifted by \(\delta w\))</li>
</ul>

<div class="result">
<strong>Main Result:</strong>
<ul>
    <li><strong>Exponent error = 0</strong> (exactly, for any α, β, W, n)</li>
    <li><strong>Intercept error = \(10^{\delta w(\alpha, \beta, W, n)} - 1\)</strong></li>
</ul>
</div>

<h2>7. Numerical Examples</h2>

<p>For n = 15 points:</p>

<table border="1" cellpadding="8" style="border-collapse: collapse; margin: 20px 0;">
    <tr>
        <th>Surface</th>
        <th>α</th>
        <th>β</th>
        <th>W</th>
        <th>δw</th>
        <th>Intercept error</th>
    </tr>
    <tr>
        <td>Symmetric</td>
        <td>0.31</td>
        <td>0.31</td>
        <td>1.0</td>
        <td>0</td>
        <td>0%</td>
    </tr>
    <tr>
        <td>Chinchilla</td>
        <td>0.34</td>
        <td>0.28</td>
        <td>0.3</td>
        <td>0.0014</td>
        <td>0.33%</td>
    </tr>
    <tr>
        <td>Chinchilla</td>
        <td>0.34</td>
        <td>0.28</td>
        <td>1.0</td>
        <td>0.0117</td>
        <td>2.7%</td>
    </tr>
    <tr>
        <td>Chinchilla</td>
        <td>0.34</td>
        <td>0.28</td>
        <td>2.0</td>
        <td>0.0626</td>
        <td>15.5%</td>
    </tr>
    <tr>
        <td>High imbalance</td>
        <td>0.465</td>
        <td>0.155</td>
        <td>1.0</td>
        <td>0.0601</td>
        <td>14.8%</td>
    </tr>
    <tr>
        <td>High imbalance</td>
        <td>0.465</td>
        <td>0.155</td>
        <td>2.0</td>
        <td>0.286</td>
        <td>99.2%</td>
    </tr>
</table>

<h2>8. Summary</h2>

<div class="result">
<p>The vertex shift \(\delta w\) is a closed-form function of α, β, W, and n:</p>

\[ \delta w = f(\alpha, \beta, W, n) \]

<p>Key properties:</p>
<ul>
    <li>\(\delta w = 0\) when \(\alpha = \beta\) (symmetric loss)</li>
    <li>\(\delta w\) grows with \(|\alpha - \beta|\) (asymmetry)</li>
    <li>\(\delta w\) grows with \(W\) (wider sampling range)</li>
    <li>\(\delta w\) is <strong>independent of C</strong> → exponent is exactly preserved</li>
</ul>
</div>

</body>
</html>
